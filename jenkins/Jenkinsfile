pipeline {
    agent any

    environment {
        OUTPUT_DIRECTORY = ".output"
    }

    options {
        skipDefaultCheckout()
    }

    stage {
        steps('Stage name') {
            echo 'Stage 1 started'
        }
    }

    stage {
        steps('Pod install') {
            steps {
                echo 'Installing pods'
                sh 'pod install'
            }
        }
    }

    stage {
        steps('Build and test') {
            steps {
                catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
                    sh 'build_and_unit_test'
                }
            }
        }
    }

    post {
        success {
            echo 'CI exitóso'
        }
        failure {
            echo 'CI fallído'
        }
    	always {
            //echo 'CI terminó'
            echo 'Saving artifacts ...'
            archiveArtifacts artifacts: "${OUTPUT_DIRECTORY}/*.*"
            //cleanWs()
    	}
    }
}